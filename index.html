<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KRWL - Formulir Pendaftaran</title>
    <style>
        :root {
            --primary-color: #05aedf;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --text-color: #333;
            --light-color: #f9f9f9;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo {
            margin-bottom: 15px;
        }

        .logo img {
            height: 80px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .form-container {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
            outline: none;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #0499c4;
            transform: translateY(-2px);
        }

        .btn-submit {
            display: block;
            margin: 30px auto 0;
        }

        .btn-add {
            background-color: var(--accent-color);
            padding: 8px 16px;
            font-size: 16px;
        }

        .btn-add:hover {
            background-color: #e68a00;
        }

        .btn-remove {
            background-color: #f44336;
            padding: 8px 16px;
            font-size: 16px;
            margin-left: 10px;
        }

        .btn-remove:hover {
            background-color: #d32f2f;
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 20px;
            background-color: #dff0d8;
            color: #3c763d;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .error-message {
            display: none;
            text-align: center;
            padding: 20px;
            background-color: #f8d7da;
            color: #721c24;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loading:after {
            content: "...";
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }

        .pendaftar-list {
            margin-top: 20px;
        }

        .pendaftar-item {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .pendaftar-container {
            margin-top: 10px;
        }

        .pendaftar-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .pendaftar-input-group input {
            flex: 1;
        }

        .pendaftar-count {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 5px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 600px) {
            .form-container {
                padding: 20px;
            }

            header h1 {
                font-size: 24px;
            }

            .logo img {
                height: 60px;
            }
        }

        .hidden-iframe {
            display: none;
            width: 0;
            height: 0;
            border: 0;
            border: none;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo">
            <img src="logo.png" alt="KRWL Logo">
        </div>
        <h1>KRWL - Formulir Pendaftaran</h1>
        <p>Silakan isi formulir di bawah ini dengan lengkap</p>
    </header>

    <div class="form-container">
        <form id="registrationForm">
            <div class="form-group">
                <label for="kodeKRWL">Kode ID KRWL</label>
                <input type="text" id="kodeKRWL" name="kodeKRWL" required>
            </div>

            <div class="form-group">
                <label for="kodeSubmit">Kode ID Submit</label>
                <input type="text" id="kodeSubmit" name="kodeSubmit" required>
            </div>

            <div class="form-group">
                <label for="kodeLocus">Kode ID Locus</label>
                <input type="text" id="kodeLocus" name="kodeLocus" required>
            </div>

            <div class="form-group">
                <label for="namaKoordinator">Nama Koordinator</label>
                <input type="text" id="namaKoordinator" name="namaKoordinator" required>
            </div>

            <div class="form-group">
                <label>Nama Calon Pendaftar</label>
                <p class="instruction">Masukkan nama satu per satu lalu klik tombol "Tambah"</p>

                <div class="pendaftar-container">
                    <div class="pendaftar-input-group">
                        <input type="text" id="pendaftarInput" class="pendaftar-input" placeholder="Masukkan nama pendaftar">
                        <button type="button" class="btn-add" onclick="addPendaftar()">Tambah</button>
                    </div>
                </div>

                <div id="pendaftarCount" class="pendaftar-count">Jumlah pendaftar: 0</div>
                <div id="pendaftarList" class="pendaftar-list"></div>
                <input type="hidden" id="namaPendaftar" name="namaPendaftar">
            </div>

            <div class="form-group">
                <label for="tahapanUpdate">Tahapan Update</label>
                <select id="tahapanUpdate" name="tahapanUpdate" required>
                    <option value="" disabled selected>Pilih tahapan...</option>
                    <option value="T1">T1</option>
                    <option value="T2">T2</option>
                    <option value="T3">T3</option>
                    <option value="T4">T4</option>
                    <option value="T5">T5</option>
                    <option value="Obs">Obs</option>
                    <option value="Mt">Mt</option>
                    <option value="Ok">Ok</option>
                </select>
            </div>

            <button type="submit" class="btn-submit">Kirim</button>
        </form>

        <div class="loading" id="loading">Mengirim data</div>
        <div class="success-message" id="successMessage">
            <h3>Terima kasih!</h3>
            <p>Data Anda telah berhasil dikirim.</p>
        </div>
        <div class="error-message" id="errorMessage">
            <h3>Maaf!</h3>
            <p>Terjadi kesalahan saat mengirim data. Silakan coba lagi.</p>
            <p id="errorDetail"></p>
        </div>
    </div>
</div>

<!-- Hidden iframe for form submission -->
<iframe name="hidden-iframe" class="hidden-iframe" id="hidden-iframe"></iframe>

<script>
    // Array untuk menyimpan daftar pendaftar
    let pendaftarList = [];

    // Fungsi untuk menambahkan pendaftar
    function addPendaftar() {
        const pendaftarInput = document.getElementById('pendaftarInput');
        const pendaftarName = pendaftarInput.value.trim();

        if (pendaftarName) {
            // Tambahkan ke array
            pendaftarList.push(pendaftarName);

            // Update hidden input
            document.getElementById('namaPendaftar').value = pendaftarList.join('\n');

            // Tambahkan ke daftar visual
            const pendaftarListElement = document.getElementById('pendaftarList');
            const newItem = document.createElement('div');
            newItem.className = 'pendaftar-item';
            newItem.innerHTML = `
                <span>${pendaftarName}</span>
                <button type="button" class="btn-remove" onclick="removePendaftar(${pendaftarList.length - 1})">Hapus</button>
            `;
            pendaftarListElement.appendChild(newItem);

            // Update jumlah pendaftar
            updatePendaftarCount();

            // Reset input
            pendaftarInput.value = '';
            pendaftarInput.focus();
        }
    }

    // Fungsi untuk menghapus pendaftar
    function removePendaftar(index) {
        // Hapus dari array
        pendaftarList.splice(index, 1);

        // Update hidden input
        document.getElementById('namaPendaftar').value = pendaftarList.join('\n');

        // Perbarui seluruh daftar visual
        updatePendaftarList();

        // Update jumlah pendaftar
        updatePendaftarCount();
    }

    // Fungsi untuk memperbarui tampilan daftar pendaftar
    function updatePendaftarList() {
        const pendaftarListElement = document.getElementById('pendaftarList');
        pendaftarListElement.innerHTML = '';

        pendaftarList.forEach((name, index) => {
            const newItem = document.createElement('div');
            newItem.className = 'pendaftar-item';
            newItem.innerHTML = `
                <span>${name}</span>
                <button type="button" class="btn-remove" onclick="removePendaftar(${index})">Hapus</button>
            `;
            pendaftarListElement.appendChild(newItem);
        });
    }

    // Fungsi untuk memperbarui jumlah pendaftar
    function updatePendaftarCount() {
        const countElement = document.getElementById('pendaftarCount');
        countElement.textContent = `Jumlah pendaftar: ${pendaftarList.length}`;

        // Ubah warna berdasarkan jumlah
        if (pendaftarList.length === 0) {
            countElement.style.color = '#f44336'; // Merah jika tidak ada pendaftar
        } else {
            countElement.style.color = '#05aedf'; // Warna primary jika ada pendaftar
        }
    }

    // Tangani enter key pada input pendaftar
    document.getElementById('pendaftarInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            addPendaftar();
        }
    });

    // Form submission handler
    document.getElementById('registrationForm').addEventListener('submit', function(event) {
        event.preventDefault();

        // Periksa apakah ada pendaftar
        if (pendaftarList.length === 0) {
            alert('Harap tambahkan minimal satu pendaftar');
            document.getElementById('pendaftarInput').focus();
            return;
        }

        // Get form elements
        const form = document.getElementById('registrationForm');
        const loading = document.getElementById('loading');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const errorDetail = document.getElementById('errorDetail');

        // Hide error message if previously shown
        errorMessage.style.display = 'none';

        // Show loading
        loading.style.display = 'block';

        // Collect form data
        const formData = new FormData(form);
        const data = {};

        // Map form parameter names to spreadsheet column names
        const parameterMapping = {
            'kodeKRWL': 'Kode ID KRWL',
            'kodeSubmit': 'Kode ID Submit',
            'kodeLocus': 'Kode ID Locus',
            'namaKoordinator': 'Nama Koordinator',
            'namaPendaftar': 'Nama Calon Pendaftar',
            'tahapanUpdate': 'Tahapan Update'
        };

        formData.forEach((value, key) => {
            const spreadsheetKey = parameterMapping[key] || key;
            data[spreadsheetKey] = value;
        });

        console.log("Data yang akan dikirim:", data);

        // Google Apps Script Web App URL
        const scriptURL = 'https://script.google.com/macros/s/AKfycbz_3CsDlrEp9RKBqErNrqwy24QsvihIJvo8FkCGX5Z3_Eq6BEscrSiTl83scK0oSCJC/exec';

        // Create a form to submit
        const tempForm = document.createElement('form');
        tempForm.method = 'POST';
        tempForm.action = scriptURL;
        tempForm.target = 'hidden-iframe'; // Target the hidden iframe

        // Add data as a hidden field
        const hiddenField = document.createElement('input');
        hiddenField.type = 'hidden';
        hiddenField.name = 'data';
        hiddenField.value = JSON.stringify(data);
        tempForm.appendChild(hiddenField);

        // Add form to the document and submit it
        document.body.appendChild(tempForm);

        // Set a timeout to show success message after 2 seconds
        setTimeout(function() {
            loading.style.display = 'none';
            form.style.display = 'none';
            successMessage.style.display = 'block';

            // Remove the form from the document
            document.body.removeChild(tempForm);
        }, 2000);

        // Submit the form
        tempForm.submit();
    });
</script>
</body>
</html>